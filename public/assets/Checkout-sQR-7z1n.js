import{j as e,P as X,S as Z,t as _,a as ee,b as re,d as se,e as te,B as p,C as R,f as $,g as A,h as O,i as V,I,k as L,l as ae,m as oe}from"./index-B47FFcJk.js";import{r as l}from"./react-Dneogk0_.js";import{g as E,s as S,b as ne,F as ie,C as ce,u as le,c as de,d as me,e as ue,z as b}from"./vendor-DdSLAvpX.js";import{f as N,c as xe}from"./currency-ByeFX4iW.js";import{M as fe,P as he}from"./plus-BPji9f-M.js";import{T as pe}from"./trash-2-mPRMo0Fe.js";const q=(r,a,s)=>{if(r&&"reportValidity"in r){const t=E(s,a);r.setCustomValidity(t&&t.message||""),r.reportValidity()}},U=(r,a)=>{for(const s in a.fields){const t=a.fields[s];t&&t.ref&&"reportValidity"in t.ref?q(t.ref,s,r):t&&t.refs&&t.refs.forEach(o=>q(o,s,r))}},je=(r,a)=>{a.shouldUseNativeValidation&&U(r,a);const s={};for(const t in r){const o=E(a.fields,t),i=Object.assign(r[t]||{},{ref:o&&o.ref});if(ge(a.names||Object.keys(r),t)){const c=Object.assign({},E(s,t));S(c,"root",i),S(s,t,c)}else S(s,t,i)}return s},ge=(r,a)=>{const s=z(a);return r.some(t=>z(t).match(`^${s}\\.\\d+`))};function z(r){return r.replace(/\]|\[/g,"")}function ye(r,a){for(var s={};r.length;){var t=r[0],o=t.code,i=t.message,c=t.path.join(".");if(!s[c])if("unionErrors"in t){var d=t.unionErrors[0].errors[0];s[c]={message:d.message,type:d.code}}else s[c]={message:i,type:o};if("unionErrors"in t&&t.unionErrors.forEach(function(g){return g.errors.forEach(function(f){return r.push(f)})}),a){var m=s[c].types,u=m&&m[t.code];s[c]=ne(c,a,s,o,u?[].concat(u,t.message):t.message)}r.shift()}return s}function be(r,a,s){return s===void 0&&(s={}),function(t,o,i){try{return Promise.resolve(function(c,d){try{var m=Promise.resolve(r[s.mode==="sync"?"parse":"parseAsync"](t,a)).then(function(u){return i.shouldUseNativeValidation&&U({},i),{errors:{},values:s.raw?Object.assign({},t):u}})}catch(u){return d(u)}return m&&m.then?m.then(void 0,d):m}(0,function(c){if(function(d){return Array.isArray(d==null?void 0:d.errors)}(c))return{values:{},errors:je(ye(c.errors,!i.shouldUseNativeValidation&&i.criteriaMode==="all"),i)};throw c}))}catch(c){return Promise.reject(c)}}}var Ne="Label",B=l.forwardRef((r,a)=>e.jsx(X.label,{...r,ref:a,onMouseDown:s=>{var o;s.target.closest("button, input, select, textarea")||((o=r.onMouseDown)==null||o.call(r,s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));B.displayName=Ne;var Y=B;function j(...r){return _(ee(r))}const ve=re("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),Q=l.forwardRef(({className:r,...a},s)=>e.jsx(Y,{className:j(ve(),r),...a}));Q.displayName=Y.displayName;const we=ie,W=l.createContext({}),k=({...r})=>e.jsx(W.Provider,{value:{name:r.name},children:e.jsx(ce,{...r})}),P=()=>{const r=l.useContext(W),a=l.useContext(H),{getFieldState:s,formState:t}=le(),o=s(r.name,t);if(!r)throw new Error("useFormField should be used within <FormField>");const{id:i}=a;return{id:i,name:r.name,formItemId:`${i}-form-item`,formDescriptionId:`${i}-form-item-description`,formMessageId:`${i}-form-item-message`,...o}},H=l.createContext({}),v=l.forwardRef(({className:r,...a},s)=>{const t=l.useId();return e.jsx(H.Provider,{value:{id:t},children:e.jsx("div",{className:j("space-y-2",r),...a})})});v.displayName="FormItem";const w=l.forwardRef(({className:r,...a},s)=>{const{error:t,formItemId:o}=P();return e.jsx(Q,{className:j(t&&"text-destructive",r),htmlFor:o,...a})});w.displayName="FormLabel";const C=l.forwardRef(({...r},a)=>{const{error:s,formItemId:t,formDescriptionId:o,formMessageId:i}=P();return e.jsx(Z,{id:t,"aria-describedby":s?`${o} ${i}`:`${o}`,"aria-invalid":!!s,...r})});C.displayName="FormControl";const M=l.forwardRef(({className:r,...a},s)=>{const{formDescriptionId:t}=P();return e.jsx("p",{id:t,className:j("text-sm text-muted-foreground",r),...a})});M.displayName="FormDescription";const F=l.forwardRef(({className:r,children:a,...s},t)=>{const{error:o,formMessageId:i}=P(),c=o?String(o==null?void 0:o.message):a;return c?e.jsx("p",{id:i,className:j("text-sm font-medium text-destructive",r),...s,children:c}):null});F.displayName="FormMessage";const Ce=b.object({customerName:b.string().min(2,{message:"Name must be at least 2 characters"}),customerEmail:b.string().email({message:"Please enter a valid email address"}),customerPhone:b.string().min(10,{message:"Please enter a valid phone number"})});function Te(){de();const r=me(),{toast:a}=se(),{cartItems:s,removeItem:t,updateQuantity:o,getCartTotal:i,getTaxAmount:c,getFinalTotal:d,clearCart:m,cartId:u,isLoading:g}=te(),[f,T]=l.useState(!1),h=ue({resolver:be(Ce),defaultValues:{customerName:"",customerEmail:"",customerPhone:""}}),D=async n=>{if(s.length===0){a({title:"Cart is empty",description:"Add some items to your cart before checking out"});return}T(!0);try{const x={order:{...n,totalAmount:d()},items:s.map(y=>({productId:y.productId,quantity:y.quantity,price:y.product.discountPrice||y.product.price}))},K=await(await oe("POST","/api/orders",x)).json();await m(),r(`/order-confirmation/${K.id}`),a({title:"Order placed successfully",description:"Thank you for your order!"})}catch{a({title:"Error placing order",description:"There was a problem placing your order. Please try again."})}finally{T(!1)}},J=(n,x)=>{o(n,x+1)},G=(n,x)=>{x>1?o(n,x-1):t(n)};return s.length===0&&!g?e.jsx("div",{className:"container mx-auto px-4 py-12",children:e.jsxs("div",{className:"max-w-md mx-auto text-center",children:[e.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Your Cart is Empty"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Add some items to your cart before proceeding to checkout."}),e.jsx(p,{onClick:()=>r("/"),children:"Continue Shopping"})]})}):e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Checkout"}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-8",children:[e.jsx("div",{className:"lg:w-1/2",children:e.jsxs(R,{children:[e.jsxs($,{children:[e.jsx(A,{children:"Customer Information"}),e.jsx(O,{children:"Please enter your details for order pickup"})]}),e.jsx(V,{children:e.jsx(we,{...h,children:e.jsxs("form",{onSubmit:h.handleSubmit(D),className:"space-y-6",children:[e.jsx(k,{control:h.control,name:"customerName",render:({field:n})=>e.jsxs(v,{children:[e.jsx(w,{children:"Full Name"}),e.jsx(C,{children:e.jsx(I,{placeholder:"John Doe",...n})}),e.jsx(F,{})]})}),e.jsx(k,{control:h.control,name:"customerEmail",render:({field:n})=>e.jsxs(v,{children:[e.jsx(w,{children:"Email Address"}),e.jsx(C,{children:e.jsx(I,{placeholder:"john.doe@example.com",type:"email",...n})}),e.jsx(M,{children:"We'll send your order confirmation to this email"}),e.jsx(F,{})]})}),e.jsx(k,{control:h.control,name:"customerPhone",render:({field:n})=>e.jsxs(v,{children:[e.jsx(w,{children:"Phone Number"}),e.jsx(C,{children:e.jsx(I,{placeholder:"(555) 123-4567",...n})}),e.jsx(M,{children:"We'll contact you when your order is ready for pickup"}),e.jsx(F,{})]})}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg mb-4",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Pickup Information"}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Your order will be available for pickup at our store location:"}),e.jsxs("p",{className:"text-sm",children:[e.jsx("strong",{children:"DiscountMart"}),e.jsx("br",{}),"123 Main Street",e.jsx("br",{}),"Anytown, ST 12345"]})]}),e.jsx(p,{type:"submit",className:"w-full",disabled:f,children:f?"Processing...":"Place Order"})]})})})]})}),e.jsx("div",{className:"lg:w-1/2",children:e.jsxs(R,{children:[e.jsxs($,{children:[e.jsx(A,{children:"Order Summary"}),e.jsx(O,{children:"Review your items before placing your order"})]}),e.jsxs(V,{className:"space-y-4",children:[g?e.jsx("p",{children:"Loading cart items..."}):e.jsx(e.Fragment,{children:s.map(n=>e.jsxs("div",{className:"flex items-center py-4 border-b border-gray-200 last:border-b-0",children:[e.jsx("img",{src:n.product.imageUrl,alt:n.product.name,className:"w-16 h-16 object-cover rounded"}),e.jsxs("div",{className:"ml-4 flex-grow",children:[e.jsx("h3",{className:"font-medium",children:n.product.name}),e.jsx("p",{className:"text-blue-800 font-bold",children:N(xe(n.product.discountPrice||n.product.price))}),e.jsxs("div",{className:"flex items-center mt-2",children:[e.jsx(p,{variant:"outline",size:"icon",className:"h-6 w-6 rounded-full",onClick:()=>G(n.id,n.quantity),children:e.jsx(fe,{className:"h-3 w-3"})}),e.jsx("span",{className:"mx-2",children:n.quantity}),e.jsx(p,{variant:"outline",size:"icon",className:"h-6 w-6 rounded-full",onClick:()=>J(n.id,n.quantity),children:e.jsx(he,{className:"h-3 w-3"})})]})]}),e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>t(n.id),className:"text-gray-400 hover:text-red-500",children:e.jsx(pe,{className:"h-5 w-5"})})]},n.id))}),e.jsx(L,{className:"my-4"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Subtotal:"}),e.jsx("span",{className:"font-medium text-blue-800",children:N(i())})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Tax (8%):"}),e.jsx("span",{className:"font-medium text-blue-800",children:N(c())})]}),e.jsx(L,{className:"my-2"}),e.jsxs("div",{className:"flex justify-between text-lg",children:[e.jsx("span",{className:"font-bold",children:"Total:"}),e.jsx("span",{className:"font-bold text-blue-800",children:N(d())})]})]})]}),e.jsx(ae,{className:"bg-gray-50 rounded-b-lg",children:e.jsxs("div",{className:"w-full",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"By placing your order, you agree to our terms and conditions. Your items will be available for pickup at our store location."}),e.jsx(p,{className:"w-full",onClick:h.handleSubmit(D),disabled:f||s.length===0,children:f?"Processing...":"Place Order"})]})})]})})]})]})}export{Te as default};
